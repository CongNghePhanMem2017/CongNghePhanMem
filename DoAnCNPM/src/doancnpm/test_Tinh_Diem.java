/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package doancnpm;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Vector;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import java.sql.*;
import javax.swing.JLabel;
import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;

/**
 *
 * @author Elitebook
 */
public class test_Tinh_Diem extends javax.swing.JInternalFrame {
   
      ConnectDB DB = new ConnectDB();      
       private String header[] = {"Ma Bang Diem","Nam Hoc", "Ma Mon","Hoc Ky", "Loai Kiem Tra", "Diem", "Ma_CT_BangDiem"};
    private DefaultTableModel tblModel = new DefaultTableModel(header,0);
    
    
   
                
                
    public test_Tinh_Diem() throws Exception {
        initComponents();
         Diem();
         jTable_DiemHS.setModel(tblModel);
        LoadDiem();
        NhapDiem();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable_DiemHS = new javax.swing.JTable();
        txtMaBD = new javax.swing.JTextField();
        txtNamHoc = new javax.swing.JTextField();
        jButton_them = new javax.swing.JButton();
        txthocky = new javax.swing.JTextField();
        txtloaikt = new javax.swing.JTextField();
        txtdiem = new javax.swing.JTextField();
        txtmonhoc = new javax.swing.JTextField();
        diem = new javax.swing.JLabel();

        setClosable(true);

        jTable_DiemHS.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4", "Title 5", "Title 6", "Title 7"
            }
        ));
        jScrollPane1.setViewportView(jTable_DiemHS);

        txtMaBD.setText(" ");

        txtNamHoc.setText(" ");

        jButton_them.setText("them");
        jButton_them.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_themActionPerformed(evt);
            }
        });

        txthocky.setText(" ");

        txtloaikt.setText(" ");

        txtdiem.setText(" ");

        txtmonhoc.setText(" ");

        diem.setText("jLabel2");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(96, Short.MAX_VALUE)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 689, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(51, 51, 51))
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(57, 57, 57)
                        .addComponent(jLabel1))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(163, 163, 163)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtNamHoc, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtMaBD, javax.swing.GroupLayout.PREFERRED_SIZE, 130, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(49, 49, 49)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(jButton_them)
                                .addGap(24, 24, 24)
                                .addComponent(txtloaikt, javax.swing.GroupLayout.PREFERRED_SIZE, 68, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(81, 81, 81)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(txthocky, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 68, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(txtmonhoc, javax.swing.GroupLayout.PREFERRED_SIZE, 68, javax.swing.GroupLayout.PREFERRED_SIZE))))
                        .addGap(48, 48, 48)
                        .addComponent(txtdiem, javax.swing.GroupLayout.PREFERRED_SIZE, 117, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(210, 210, 210)
                        .addComponent(diem, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(66, 66, 66)
                .addComponent(jLabel1)
                .addGap(22, 22, 22)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtMaBD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtmonhoc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(txtNamHoc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(9, 9, 9)
                        .addComponent(jButton_them))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(4, 4, 4)
                        .addComponent(txthocky, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtloaikt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtdiem, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(35, 35, 35)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 108, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(34, 34, 34)
                .addComponent(diem, javax.swing.GroupLayout.PREFERRED_SIZE, 23, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(109, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton_themActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_themActionPerformed
          try {
              // TODO add your handling code here:
              NhapDiem();
              Diem() ;
          } catch (Exception ex) {
              Logger.getLogger(test_Tinh_Diem.class.getName()).log(Level.SEVERE, null, ex);
          }
        
    }//GEN-LAST:event_jButton_themActionPerformed

   public void LoadDiem(){
        
       try {
            DB.conn = DriverManager.getConnection(DB.dbURL);  
            // Câu lệnh xem dữ liệu
            String sql = "select * from Test_Diem_Thu ";
            // Tạo đối tượng thực thi câu lệnh Select
            DB.st = DB.conn.createStatement();

            // Thực thi 
            DB.rs = DB.st.executeQuery(sql);
            Vector data = null;

            tblModel.setRowCount(0);
        

            // Trong khi chưa hết dữ liệu
            while (DB.rs.next()) {
                data = new Vector();
                data.add(DB.rs.getString("MaBangDiem"));
                data.add(DB.rs.getString("NamHoc"));
                data.add(DB.rs.getString("MaMon"));
                data.add(DB.rs.getString("HocKy"));
                data.add(DB.rs.getString("MaLoaiKiemTra"));
                data.add(DB.rs.getString("Diem"));
                data.add(DB.rs.getString("Ma_CT_BangDiem"));
       
                // Thêm một dòng vào table model
                 tblModel.addRow(data);
            }

            // Thêm dữ liệu vào table

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                if (DB.conn != null) {
                    DB.conn.close();
                }
                if (DB.st != null) {
                    DB.st.close();
                }
                if (DB.rs != null) {
                    DB.rs.close();
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        }
   }
   private void Diem()  throws Exception{
       
       ConnectionToSQL cn = new ConnectionToSQL();
       Connection cnn = cn.getConnection();
       try {
           CallableStatement sql = cnn.prepareCall("{call slsv (?)}");
           sql.setString(1,"10a117");
           sql.registerOutParameter(1,java.sql.Types.INTEGER);
           sql.execute();
            int   ret=sql.getInt(1);
            System.out.println ("sl" +ret);
       } catch (Exception e) {
       }
          
     
    
   }
   
    
   public void NhapDiem() {
       ConnectionToSQL cn=new ConnectionToSQL();
       Connection cnn=cn.getConnection();
         try {  
             CallableStatement sql = cnn.prepareCall("{call sp_Test_Diem_Thu_NhapDiem (?,?,?,?,?,?)}");
                  sql.setString(1,txtMaBD.getText());
                  sql.setString(2,txtNamHoc.getText());
                  sql.setString(3, txtmonhoc.getText());
                  sql.setString(4, txthocky.getText());
                  sql.setString(5, txtloaikt.getText());
                  sql.setString(6, txtdiem.getText());
                  sql.execute();

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                if (DB.conn != null) {
                    DB.conn.close();
                }
                if (DB.st != null) {
                    DB.st.close();
                }
                if (DB.rs != null) {
                    DB.rs.close();
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        }
         
       
       /*
        DefaultTableModel model = (DefaultTableModel) jTable_DiemHS.getModel();     
         try {
             DB.conn=DriverManager.getConnection(DB.dbURL);
             String sql = "select * from Test_Diem_Thu";
              DB.st = DB.conn.createStatement();
              
                DB.rs = DB.st.executeQuery(sql);
                 DB.rs = DB.st.executeQuery(sql);
                 
                 Vector data = null;
                     model.setRowCount(0);
                  if (DB.rs.isBeforeFirst() == false) {
                JOptionPane.showMessageDialog(this, "The Diem_Thu is not available!");
                return;
                  }
                  tblModel.setRowCount(0);
                  
                 while (DB.rs.next()) {
                data = new Vector();
                data.add(DB.rs.getString("Ma_CT_BangDiem"));
                data.add(DB.rs.getString("MaBangDiem"));
                data.add(DB.rs.getString("NamHoc"));
                data.add(DB.rs.getString("MaMon"));
                data.add(DB.rs.getString("HocKy"));
                data.add(DB.rs.getString("MaLoaiKiemTra"));
                data.add(DB.rs.getString("Diem"));
                 model.addRow(data);
            }
                  jTable_DiemHS.setModel(model);
        
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                if (DB.conn != null) {
                    DB.conn.close();
                }
                if (DB.st != null) {
                    DB.st.close();
                }
                if (DB.rs != null) {
                    DB.rs.close();
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        }
        */
       LoadDiem();
     }
       

   
    
    
 
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel diem;
    private javax.swing.JButton jButton_them;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable_DiemHS;
    private javax.swing.JTextField txtMaBD;
    private javax.swing.JTextField txtNamHoc;
    private javax.swing.JTextField txtdiem;
    private javax.swing.JTextField txthocky;
    private javax.swing.JTextField txtloaikt;
    private javax.swing.JTextField txtmonhoc;
    // End of variables declaration//GEN-END:variables

    
   
}
class Diem
{
    private String mabd,manh;

    public String getMabd() {
        return mabd;
    }

    public void setMabd(String mabd) {
        this.mabd = mabd;
    }

    public String getManh() {
        return manh;
    }

    public void setManh(String manh) {
        this.manh = manh;
    }
    
    
    public Diem() {
    }

    public Diem(String mabd, String manh) {
        this.mabd = mabd;
        this.manh = manh;
        ;
    }
    @Override
    public  String toString()
    {
        return mabd+ " "+ manh;
    }
}
